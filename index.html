<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico">
        <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="tomaz.me feed" />
        <meta name="google-site-verification" content="ynmOt0WzX8sVTNjmph4-tcmcUq8GzD3ao2AqpUJVlcY" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <meta name="description" content="Tomaz Muraus' personal blog - technology, distributed systems, open source, startups and life">
        <meta name="author" content="Tomaz Muraus">
        <title>thoughts which have made it into written existence | tomaz.me</title>

        <link href='/assets/global-c8260e9613c27af044baaada38d1d572.css' rel='stylesheet' type='text/css' />

    </head>
    <body>
        <div id="links" class="menu">
            <ul class="nobullet">
                <li><a href="/index.html">Home</a></li>
                <li><a href="/archive.html">Archive</a></li>
                <li><a href="/atom.xml">Feed</a></li>
                <li><a href="/about.html">About</a></li>

                <li><br /></li>
                <li class="title">Find me on</li>
                <li><span class='icon icon-twitter'></span><a href="http://twitter.com/KamiSLO">Twitter</a></li>
                <li><span class='icon icon-gplus'></span><a href="https://plus.google.com/106838062648597435631/about">Google+</a></li>
                <li><span class='icon icon-github'></span><a href="http://github.com/Kami">Github</a></li>
                <li><span class='icon icon-launchpad'></span><a href="https://launchpad.net/~tomaz-muraus">Launchpad</a></li>
                <li><span class='icon icon-linkedin'></span><a href="http://www.linkedin.com/in/tomazmuraus">LinkedIn</a></li>
                <li><span class='icon icon-masterbranch'></span><a href="https://masterbranch.com/tomaz.muraus">MasterBranch</a></li>

                <li><br /></li>
                <li class="title">Friends and other blogs</li>
                <li><a href="http://russellhaering.com/">Russell's blog</a></li>
                <li><a href="http://journal.paul.querna.org/">Paul's journal</a></li>
                <li><a href="http://geoff.greer.fm/">Geoff's site</a></li>

                <li><br /></li>
                <li class="title">Currently reading and recently read</li>
              </ul>

              <div id="w8e3b8b0aeeaab2d06ec0a21fd4db3b8f"></div>
        </div>
        <div id="wrapper">
            <div id="header">
                <div class="logo"></div>
                <h1><a href="/index.html">computers, programming, ponies and snakes.</a></h1>
            </div>
            <div id="content">
                
<div class="post">
    <h2 id='work_visa_and_moving_from_the_us_back_to_your_home_country'><a href='/2013/06/20/work-visa-and-moving-from-the-us-back-to-your-home-country.html'>Work visa and moving from the US back to your home country</a></h2>

<p>In my <a href='/2013/06/09/time-for-new-challenges.html'>recent post</a> I wrote that I&#8217;m leaving my current job and moving back to Slovenia to start working on my own startup. In this post I&#8217;m going to provide a high level overview of a process and most of the bureaucratic things which are involved if you have a some kind of work visa (H1B in my case) and you want to move back to your home country.</p>

<h3 id='motivation'>Motivation</h3>

<p>If you search around the web you can find plenty of blog posts, articles and resources for people who got a job or want to work in the US ( e.g. <a href='http://blog.penso.info/2013/05/25/getting-a-job-in-san-francisco/'>&#8220;Getting a job in San Francisco&#8221;</a>).</p>
<div class='imginline'><a class='fancybox' href='/images/work-visa-and-moving-from-the-us-back-to-your-home-country/golden_gate_bridge.jpg' title='Golden Gate Bridge, San Francisco, California'><img class='inline' src='/images/work-visa-and-moving-from-the-us-back-to-your-home-country/golden_gate_bridge_thumb.jpg' /></a><span class='image-caption'>Golden Gate Bridge, San Francisco, California</span></div>
<p>The same is not true if you turn the situation around. If you currently hold some kind of work visa and you want to move back to the home country there are basically no high level resources you could use to know what to expect.</p>

<p>I recently went through this process myself so I have fresh and first hand experience. Actual process involved a lot digging and reading through long and mostly boring legal documents.</p>

<p>I hope this post will act as a high level overview, help other people in a similar situation and give a better idea of how the whole thing looks like to people who never went through a process like this personally.</p>

<p>A lot of things described in this post are similar to the process you need to go through if you are just changing your job or moving to a different location, but there are two major differences:</p>

<ol>
<li>If you have H1B, there is no grace period which means you are on a tight schedule and need to make sure all the dates align perfectly.</li>

<li>You are mostly on your own. If you get a job offer from a respectful company in the US, the company will usually pay the lawyers and take care most of the bureaucracy. The whole process is still very stressful and there are a lot of factors you nor lawyers can control, but at least you are not on your own.</li>
</ol>

<h3 id='disclaimer'>Disclaimer</h3>

<p>First I want to add that I&#8217;m going to talk about my specific case and people who hold H1B visa. The same things might not apply to other type of visas valid for work.</p>

<p><strong>Second of all, I&#8217;m not a lawyer nor a tax adviser so please, if you are not sure about something, do your own research and consult your lawyer and / or tax adviser before doing something based just on this blog post.</strong></p>

<h3 id='why_move_outside_of_the_us_in_the_first_place'>Why move outside of the US in the first place?</h3>

<p>First of all, a lot of people will ask why move outside of the US in the first place? Why not just start the company in the US? Isn&#8217;t Silicon Valley one of the best places for a technical and social startup to be?</p>

<p>To start with the last questions - the answer is yes. For majority of the technical and social startups Silicon Valley indeed is the best place to be.</p>

<p>Sadly if you are foreign-born and don&#8217;t have a US citizenship you are mostly out of luck. The reason is that US immigration doesn&#8217;t welcome foreign-born entrepreneurs without US citizenship and makes it basically impossible to start your own company in the US if you don&#8217;t have a lot of money to try your bets with the investor visa (E2) or similar.</p>
<div class='imginline'><a class='fancybox' href='/images/work-visa-and-moving-from-the-us-back-to-your-home-country/startup_immigration.png' title='Visualization of different type of visas and path to the green card. Source:
http://fundersandfounders.com/coming-to-america-for-entrepreneurs-infographic/'><img class='inline' src='/images/work-visa-and-moving-from-the-us-back-to-your-home-country/startup_immigration_thumb.png' /></a><span class='image-caption'>Visualization of different type of visas and path to the green card.</span></div>
<p>That is very sad, especially because a lot of large and successful US companies were started by foreign-born entrepreneurs. The whole immigration problem is a very complex topic and I can&#8217;t do it justice in a single paragraph. All I can say is that I&#8217;m happy to see other countries recognizing this problem and trying to do something about it (examples include <a href='http://startupchile.org/'>StartupChile</a> sponsored by the Chilean government and <a href='http://www.cic.gc.ca/english/immigrate/business/start-up/index.asp?utm_source=slash-startup&amp;utm_medium=short-url&amp;utm_campaign=generic'>Canada&#8217;s Start-Up Visa program</a>).</p>
<div class='imginline'><a class='fancybox' href='/images/work-visa-and-moving-from-the-us-back-to-your-home-country/canada_startup_visa_billboard.jpg' title='Billboard on U.S. 101. Bold and clever way of advertising Canada&apos;s new Start-Up Visa.
Source: http://www.cic.gc.ca/english/department/media/photos/high-res/index.asp?p=105'><img class='inline' src='/images/work-visa-and-moving-from-the-us-back-to-your-home-country/canada_startup_visa_billboard_thumb.jpg' /></a><span class='image-caption'>Billboard on U.S. 101. Bold and clever way of advertising Canada's new Start-Up Visa.</span></div>
<p>Luckily recently a bunch of well known Silicon Valley entrepreneurs have stepped together and started working on a new immigration reform. The whole reform is not ideal, but it&#8217;s a step in the right direction and a big improvement over the current situation. I hope the bill will pass in the senate, but I&#8217;m not too optimistic because similar efforts have failed in the past.</p>

<h3 id='h1b_and_grace_period'>H1B and grace period</h3>

<p>Contrary to a popular belief there is no grace period for H1B holders. You lose your H1B (and your status) as soon as you leave your job.</p>

<p>If you want to do everything correctly and / or come back in the future it should be in your best interest to leave the country as soon as possible after your last work day.</p>

<p>In my case I left the country one day after my last working day.</p>

<h3 id='resignation_letter'>Resignation Letter</h3>

<p>In California you are employed at will which in the layman&#8217;s terms means that either you or your employer can terminate the employment relationship at any time, with or without reason (exceptions include discriminatory and a couple of other reasons).</p>

<p>Common practice when quitting your job is to give around 2 week notice to your employer. In a special case like this you need to figure a lot of things out (401k, apartment, ESPP, selling your belongings, etc.) which aren&#8217;t under your control and involve talking to HR and other people and institutions.</p>

<p>This means you should take all of this into account before giving your notice and make sure you have plenty of time to figure all of this out.</p>

<h3 id='sailing_permit_taxes_and_the_irs'>Sailing permit, taxes and the IRS</h3>

<p>If you are on a work visa and you are going to leave a country for a longer period you need to obtain a document called &#8221;<a href='http://www.irs.gov/publications/p519/ch11.html'>sailing permit</a>&#8221; from the IRS.</p>

<p>If you read about it online, people says that almost no one checks for a sailing permit when you leave the country. If you ever want to return to the US and do everything the right way you should obtain this document.</p>

<p>To purpose of this document is to prove IRS that you don&#8217;t ow them any money and if you do, you need to pay it before you can get a permit and legally leave the country.</p>

<p>The way this process works is as follows. You go to the local IRS office and with you, you need to have the following documents (for a full list see the <a href='http://www.irs.gov/Individuals/International-Taxpayers/Departing-Alien-Clearance-(Sailing-Permit)'>IRS website</a>):</p>

<ul>
<li>Photo ID (passport / california id / driving license)</li>

<li>Your visa (usually located in your passport)</li>

<li>Plane ticket which shows your date of departure</li>

<li>Tax return for the previous year (to show that you paid any taxes due)</li>

<li>W2&#8217;s for the previous years</li>

<li>Pay stubs for the current year (to show taxes were withheld from your paychecks)</li>

<li>Filled <a href='http://www.irs.gov/pub/irs-pdf/f1040c.pdf'>1040C</a> form</li>
</ul>
<div class='imginline'><a class='fancybox' href='/images/work-visa-and-moving-from-the-us-back-to-your-home-country/tax_forms.jpg' title='Regular 1040 tax return form. You will need to fill this
at the end of the current tax year. Source:
https://secure.flickr.com/photos/teegardin'><img class='inline' src='/images/work-visa-and-moving-from-the-us-back-to-your-home-country/tax_forms_thumb.jpg' /></a><span class='image-caption'>Regular 1040 tax return form. You
will need to fill this at the end of the current tax year.</span></div>
<p>The last part is one of the most important ones. <a href='http://www.irs.gov/pub/irs-pdf/f1040c.pdf'>1040C</a> is a one time early tax return for a foreign alien leaving the country. You basically prove that you don&#8217;t owe any taxes. If you do you need to pay them before you leave. If the IRS owes you money they won&#8217;t return this when you leave, but you need to claim that when you are filling your regular tax return for the current tax year.</p>

<p>If you only have a single source of income (your job), aren&#8217;t self employed and don&#8217;t have any vested shares, filling 1040C is pretty straightforward.</p>

<p>Keep in mind that things will get more complex when you are going to file your regular tax return for the current tax year (1040 or 1040NR). If you meet the <a href='http://www.irs.gov/taxtopics/tc851.html'>substantial presence test</a>, you will also ow US taxes for any money you make outside the US in this tax year. Most of the details again depend on your specific situation so be sure to do your own research.</p>

<p>If there is no treaty between the US and your home country you will also need pay taxes to the US and your home country. Luckily that is not the case with Slovenia, because we have <a href='http://www.irs.gov/pub/irs-trty/slovenia.pdf'>signed a treaty for avoidance of double taxation</a>.</p>

<h3 id='selling_your_belongings'>Selling your belongings</h3>

<p>This title is pretty self explanatory and it&#8217;s almost the same if you are just moving to a different location.</p>

<p>The only difference is that under this scenario you are usually under time pressure and all of the dates must line up perfectly.</p>
<div class='imginline'><a class='fancybox' href='/images/work-visa-and-moving-from-the-us-back-to-your-home-country/garage_sale_1.jpg' title='Garage sale is one way to get rid of your belongings.
Usually way more fun than selling to random creepy people on Craigslist. Source:
https://secure.flickr.com/photos/jpfinley'><img class='inline' src='/images/work-visa-and-moving-from-the-us-back-to-your-home-country/garage_sale_1_thumb.jpg' /></a><span class='image-caption'>Garage sale is one way to get rid of your belongings.
Usually way more fun than selling to random creepy people on Craigslist.</span></div>
<p>In my case, I luckily didn&#8217;t own a car or too many items so this process wasn&#8217;t too painful.</p>

<h3 id='moving_out_of_your_apartment'>Moving out of your apartment</h3>

<p>This is only applicable if you are renting as I did.</p>

<p>Specific details depend on your lease agreement, but usually you need to give at least 30-day notice in writing to your landlord.</p>

<h3 id='401k'>401k</h3>

<p>If you are enrolled into a 401k plan you have multiple options. Depending on your provider you can leave money in the account (if you ever plan to come back). Other options include transferring money to a similar fund in your home country or taking the money out when your employment has been terminated.</p>

<p>Keep in mind that under normal circumstances you can&#8217;t start a process of early withdrawal until you no longer work for a company that provides your 401k.</p>

<p>If you take the money out of the account early (before reaching the retirement age) you will also need to pay regular income tax and 10% early withdrawal penalty.</p>

<p>What is best for you depends on your specific situation, you home country and how much money you have in your account.</p>

<h3 id='bank_accounts'>Bank Accounts</h3>

<p>If you are not a citizen, most banks require you to have either social security number (SSN) or Individual Taxpayer Identification Number (ITIN) to have an account open with them.</p>

<p>If you have an H1B work visa you most likely also have a social security number, because H1B alone it&#8217;s not enough to work in the US. You usually apply for social security number as soon as you arrive in the US on H1B. Once you get your number, it&#8217;s yours for life.</p>

<p>This means that usually you can keep your bank account open, unless your bank also requires you to have a valid US address. Some banks require that while others allow foreign account holders. It&#8217;s best to check with your bank.</p>

<h3 id='health_insurance'>Health Insurance</h3>

<p>Usually when you leave a job your company insurance is not valid anymore. Specifics depend on the company. In some cases insurance is still valid until the end of the month and in case of layovers company might even pay insurance for a couple of more months after the termination.</p>

<p>Health care can be a big and expensive pain if you are temporarily without a job in the US (e.g. <a href='http://en.wikipedia.org/wiki/Consolidated_Omnibus_Budget_Reconciliation_Act_of_1985'>COBRA</a>).</p>

<p>Luckily this wasn&#8217;t a problem for me because we have a universal healthcare in Slovenia and I returned back immediately after I left my job.</p>

<h3 id='conclusion'>Conclusion</h3>

<p>This blog post is pretty specific to my situation, but nevertheless I hope it will help clear things up, save time and act as general overview for other people in a similar situation.</p>
    <div class="postfooter">
        <div class="posttags">Tags: <a href="/tags/personal.html">personal</a>, <a href="/tags/startups.html">startups</a>, <a href="/tags/immigration.html">immigration</a></div>
        <div class="postdate">&raquo; <a href="/2013/06/20/work-visa-and-moving-from-the-us-back-to-your-home-country.html">Jun 20, 2013</a></div>
    </div>
</div>

<div class="post">
    <h2 id='visualizing_cassandra_nodetool_cfhistograms_output_using_a_histogram'><a href='/2013/06/18/visualizing-cassandra-nodetool-cfhistograms-output-using-a-histogram.html'>Visualizing Cassandra nodetool cfhistograms output using a histogram</a></h2>

<p><a href='https://cassandra.apache.org/'>Apache Cassandra</a> includes a lot of functionality and tools which provide good visibility into your cluster health and performance.</p>

<p>A lot of this performance and health related metrics are exposed over the <a href='https://wiki.apache.org/cassandra/JmxInterface'>JMX interface</a> and through the <a href='https://wiki.apache.org/cassandra/NodeTool'>nodetool</a> command line tool. nodetool is a simple wrapper around JMX interface which allows you to access some of the most commonly used attributes through a simple command line interface.</p>

<p>Another feature which was added recently and is available in Cassandra 1.2 is a feature called <a href='http://www.datastax.com/dev/blog/tracing-in-cassandra-1-2'>request tracing</a>. Request tracing allows you see exactly what happens during a query executing and exactly how long each step takes.</p>
<div class='imginline'><a class='fancybox' href='/images/2013-06-18-visualizing-cassandra-nodetool-cfhistograms-output-using-a-histogram/request_tracing.png' title='Example of the request tracing session output. Source:
http://www.datastax.com/dev/blog/tracing-in-cassandra-1-2'><img class='inline' src='/images/2013-06-18-visualizing-cassandra-nodetool-cfhistograms-output-using-a-histogram/request_tracing_thumb.png' /></a><span class='image-caption'>Example of the request tracing session output.</span></div>
<p>This data is very granular and includes everything from how much time it takes to parse the CQL query to how much time it takes to talk to other nodes in the cluster and read data from memory and / or disk.</p>

<p>This functionality is very powerful, but it&#8217;s only available in Cassandra 1.2.</p>

<p>Some of the Cassandra clusters we operate here at Rackspace, more specifically on the <a href='http://www.rackspace.com/cloud/monitoring/'>Cloud Monitoring team</a>, don&#8217;t run Cassandra 1.2 yet. Because of that, I&#8217;m going to focus on another very useful feature which is available in the older versions of Cassandra today.</p>

<p>This feature is <code>cfhistograms</code> command exposed by the <code>nodetool</code> utility.</p>

<h3 id='cfhistograms_nodetool_command'>cfhistograms nodetool command</h3>

<p><a href='http://www.datastax.com/docs/1.2/references/nodetool#nodetool-cfhistograms'>cfhistograms</a> command prints statistic <a href='https://en.wikipedia.org/wiki/Histogram'>histograms</a> for a particular column family. The output includes the following information:</p>

<ul>
<li>Distribution of the write latency</li>

<li>Distribution of the read latency</li>

<li>Distribution of number of <a href='https://wiki.apache.org/cassandra/ArchitectureSSTable'>sstables</a> accessed during a read</li>

<li>Distribution of the row size</li>

<li>Distribution of number of columns in a row</li>
</ul>
<div class='imginline'><a class='fancybox' href='/images/2013-06-18-visualizing-cassandra-nodetool-cfhistograms-output-using-a-histogram/cf_histograms_output.png' title='nodetool cfhistograms command output. Useful but hard to interpret.'><img class='inline' src='/images/2013-06-18-visualizing-cassandra-nodetool-cfhistograms-output-using-a-histogram/cf_histograms_output_thumb.png' /></a><span class='image-caption'>nodetool cfhistograms command output. Useful but hard to interpret.</span></div>
<p>This information is very useful, but the problem is that the default output is very convoluted and hard to read. If you Google around, you can find some good posts which explain how to interpret this output (e.g. <a href='http://narendrasharma.blogspot.com/2011/04/cassandra-07x-understanding-output-of.html'>Cassandra 0.7.x - Understanding the output of nodetool cfhistograms</a>), but nevertheless interpreting the raw command line output is still time consuming and cumbersome.</p>

<h3 id='visualizing_cfhistograms_output'>Visualizing cfhistograms output</h3>

<p>Around a year ago I was debugging a performance issues in one of our clusters so I decided to write simple Python script which visualizes the <code>cfhistograms</code> output using a histogram.</p>

<p>This script is nothing fancy, but it does it&#8217;s job. In the background it uses a couple of lines of Python and <a href='http://matplotlib.org/'>matplotlib</a> to convert the raw text output into nice looking histograms.</p>
<div class='imginline'><a class='fancybox' href='/images/2013-06-18-visualizing-cassandra-nodetool-cfhistograms-output-using-a-histogram/sstables_histogram.png' title='Histogram generated by the script. It makes identifying the outliers just by glancing over the image a lot
easier and faster.'><img class='inline' src='/images/2013-06-18-visualizing-cassandra-nodetool-cfhistograms-output-using-a-histogram/sstables_histogram_thumb.png' /></a><span class='image-caption'>Histogram generated by the script. It makes identifying the outliers just by glancing over the image a lot
easier and faster.</span></div>
<h4 id='usage'>Usage</h4>

<p>Script is available as a <a href='https://gist.github.com/Kami/5810229'>gist on Github</a>.</p>

<h5 id='1_download_and_chmod_the_script'>1. Download and chmod the script</h5>
<div class='highlight'><pre><code class='bash'>wget <span class='s2'>&quot;https://gist.github.com/Kami/5810229/raw/189ab7232bcb6db5dd5f6871533bcb5efecdfd84/cassandra_cfhistograms_to_histogram.py&quot;</span>
chmod +x cassandra_cfhistograms_to_histogram.py
</code></pre></div>
<h5 id='2_install_the_matplotlib_dependency'>2. Install the matplotlib dependency</h5>
<div class='highlight'><pre><code class='bash'>pip install matplotlib
</code></pre></div>
<h5 id='3_run_the_script'>3. Run the script</h5>
<div class='highlight'><pre><code class='bash'>./cassandra_cfstats_histogram.py --input<span class='o'>=</span>&lt;path to the file with cfhistograms output&gt; <span class='se'>\</span>
                                 --output<span class='o'>=</span>&lt;directory where the histograms will be saved&gt;
</code></pre></div>
<p>For example:</p>
<div class='highlight'><pre><code class='bash'>./cassandra_cfstats_histogram.py --input<span class='o'>=</span>/home/myuser/cfhistograms_output.txt <span class='se'>\</span>
                                 --output<span class='o'>=</span>/home/myuser/histograms-images/
</code></pre></div>
<p>All this script does it reads data from the input file, processes it and writes 5 different histogram files to the output directory.</p>

<h3 id='conclusion'>Conclusion</h3>

<p>I hope you find it useful and this script will allow you to more easily interpret the output of nodetool <code>cfhistograms</code> command.</p>

<p>In the future, I will try to write more about how we used the output of this command in practice to identify and issue and misconfiguration in one of our clusters.</p>
    <div class="postfooter">
        <div class="posttags">Tags: <a href="/tags/cassandra.html">cassandra</a>, <a href="/tags/open%20source.html">open source</a>, <a href="/tags/histograms.html">histograms</a></div>
        <div class="postdate">&raquo; <a href="/2013/06/18/visualizing-cassandra-nodetool-cfhistograms-output-using-a-histogram.html">Jun 18, 2013</a></div>
    </div>
</div>

<div class="post">
    <h2 id='libcloud_design_day_recap_improving_libcloud_and_plans_for_the_future'><a href='/2013/06/12/libcloud-design-day-recap-improving-libcloud-and-plans-for-the-future.html'>Libcloud Design Day Recap (improving Libcloud and plans for the future)</a></h2>

<p>Yesterday we hosted <a href='https://lcdesignday.eventbrite.com'>Libcloud Design Day and Meetup</a> at the <a href='http://rackertalent.com/sanfrancisco/'>Rackspace San Francisco office</a>.</p>

<p>This blog post includes a short recap of main topics we covered. It&#8217;s assembled mostly from my <a href='https://mail-archives.apache.org/mod_mbox/libcloud-dev/201306.mbox/%3CCAJMHEmLtN9Fskqj5GTc8_Kfro08xjADvtYBSeT7i%3D-iesg%3Durg%40mail.gmail.com%3E'>Libcloud mailing list post</a>.</p>

<p>The goal of the event was to sit down with the <a href='https://libcloud.apache.org/'>Libcloud</a> users and developers, indicate current biggest pain points and weaknesses and brainstorm about possible solutions.</p>

<p>Event was relatively small, but we had a good sample set of Libcloud developers and user.</p>
<div class='imginline'><a class='fancybox' href='/images/2013-06-12-libcloud-design-day-recap-improving-libcloud-and-plans-for-the-future/lc_design_day.jpg' title='Photo taken at the event'><img class='inline' src='/images/2013-06-12-libcloud-design-day-recap-improving-libcloud-and-plans-for-the-future/lc_design_day_thumb.jpg' /></a><span class='image-caption'>Photo taken at the event</span></div>
<p>Here is an incomplete list of people who have attended the event:</p>

<ul>
<li><a href='http://journal.paul.querna.org/'>Paul Querna</a> (of Apache fame, also Libcloud committer)</li>

<li><a href='https://github.com/jedsmith/'>Jed Smith</a> (Libcloud committer)</li>

<li><a href='http://alexgaynor.net/'>Alex Gaynor</a> (PyPy, Django, Topaz, etc. contributor)</li>

<li><a href='http://glyph.twistedmatrix.com/'>Glyph Lefkowitz</a> (<a href='https://twistedmatrix.com/trac/'>Twisted</a> creator)</li>

<li><a href='http://dreid.org/'>David Reid</a> (Twisted contributor)</li>

<li>Chris from <a href='https://mist.io/'>mist.io</a> (mist.io uses Libcloud with many different providers)</li>

<li>Rick from Google working on the <a href='https://cloud.google.com/products/compute-engine'>Google Compute Engine</a> driver</li>
</ul>

<p>You might recognize some of the names above - we were very happy to have some very well known and knowledgeable people from the Python world to join us.</p>

<h3 id='pricing_data_distribution'>Pricing data distribution</h3>

<p>Currently we bundle JSON file with provider pricing data with every release. There is no documented and easy way for user to update this file or for us to ship an updated version without releasing a new version of Libcloud.</p>

<p>We should provide easy way to update this file which includes the following:</p>

<ul>
<li>Command line tool for updating the file - user can specify a custom URL to the file. By default it should point to the latest version from the version control (<a href='https://svn.apache.org/viewvc/libcloud/trunk/libcloud/data/pricing.json?view=co'>https://svn.apache.org/viewvc/libcloud/trunk/libcloud/data/pricing.json?view=co</a>)</li>

<li>Modify the code so it also tries to find the default pricing data file in <code>/home/user/.libcloud_data/pricing.json</code> (or whatever) directory</li>

<li>Document this process and add it to the documentation page</li>
</ul>

<p><em>Note: Most of code for this functionality already exists (<a href='https://github.com/apache/libcloud/blob/trunk/libcloud/pricing.py'>https://github.com/apache/libcloud/blob/trunk/libcloud/pricing.py</a>). We just need to add a code for downloading a file from a remote server and the cli tool.</em></p>

<h3 id='exception_reporting_for_partial_failures_in_the_methods_which_result_in_multiple_api_calls__http_requests'>Exception reporting for partial failures in the methods which result in multiple API calls / HTTP requests</h3>

<p>Currently we have no standard interface for exceptions which get raised during a partial failure in a method which has side affects. Partial failure means that a function which performs multiple API calls failed half way through and this potentially resulted in some (but not all) resources getting created.</p>

<p>We should provide a special exception for cases like this. This exception should contain information about resources which got created. Users can then use this information to perform &#8220;rollback&#8221; / cleanup partially created resources.</p>

<h3 id='support_for_async_api_in_the_core'>Support for async API in the core</h3>

<p>Currently we only expose sync / blocking API. This mostly works OK for simple command line scripts, but it&#8217;s less than ideal for long running process or applications which performs a lot of API calls which could be made more efficient and faster if we supported an async api.</p>

<p>As part of this change we would eventually need to refactor every driver which would also provide other side benefits such as:</p>

<ul>
<li>Code which is more maintainable and easier to test (smaller functions)</li>

<li>Easier way to handle partial failures / exceptions</li>
</ul>

<p>We didn&#8217;t come to a consensus on everything, but we agreed on a couple of things:</p>

<ul>
<li>Change should be backward compatible, we should default to the sync API and existing behavior code / shouldn&#8217;t change</li>

<li>New async API should be available separately (e.g. under <code>libcloud.async.*</code> or whatever it ends up being)</li>

<li>We should refactor internal code to follow new interfaces defined in the PEP 3156 (<a href='http://www.python.org/dev/peps/pep-3156/'>http://www.python.org/dev/peps/pep-3156/</a>)</li>

<li>We should start with a small scale experiment and try this in a single method in a compute driver</li>
</ul>

<h3 id='documentation'>Documentation</h3>

<p>We are weak on the documentation side.</p>

<p>Going forward we should strictly enforce that every patch which adds new code / functionality contains documentation and appropriate docstrings.</p>

<h3 id='migrating_to_git'>Migrating to git</h3>

<p>We want to make contributing as easy as possible. SVN doesn&#8217;t help with that and increases barrier to entry.</p>

<p>Action item here is me opening an Apache Infrastructure ticket for switching to git.</p>

<h3 id='dropping_support_for_python_25'>Dropping support for Python 2.5</h3>

<p>Supporting Python 2.5 adds code complexity which we would like to avoid. Main problem is that a bunch of CLI tools based on Libcloud usually also run on older versions of Linux distributions (e.g. RHEL 5) which still ship with Python 2.5.</p>

<p>We didn&#8217;t managed to actually talk about this one, but we should explore an option of removing support for Python 2.5 in the future release.</p>

<h3 id='conclusion'>Conclusion</h3>

<p>Overall the event was fun and productive. We had a lot of good debates and hopefully a lot of the things we talked about will result in real code and improvements in the near future :-)</p>

<p>Thanks again to everyone who joined us. If you missed the event or you couldn&#8217;t attend, don&#8217;t worry! You are more than welcome (and encouraged) to join us and share your opinion and feedback on the <a href='https://mail-archives.apache.org/mod_mbox/libcloud-dev/201306.mbox/%3CCAJMHEmLtN9Fskqj5GTc8_Kfro08xjADvtYBSeT7i%3D-iesg%3Durg%40mail.gmail.com%3E'>mailing list</a>.</p>
    <div class="postfooter">
        <div class="posttags">Tags: <a href="/tags/libcloud.html">libcloud</a>, <a href="/tags/open%20source.html">open source</a></div>
        <div class="postdate">&raquo; <a href="/2013/06/12/libcloud-design-day-recap-improving-libcloud-and-plans-for-the-future.html">Jun 12, 2013</a></div>
    </div>
</div>

<div class="post">
    <h2 id='time_for_new_challenges'><a href='/2013/06/09/time-for-new-challenges.html'>Time for new challenges</a></h2>

<p>For as long as I can remember I have been interested in startups and growing a sustainable business. I have finally decided to take the next step. I&#8217;m leaving Rackspace and moving back to Slovenia to start working on my own startup.</p>

<p>In this post I will provide some background and describe my motivation for doing that.</p>

<h3 id='history_and_background'>History and Background</h3>

<p>The last couple of years were very exciting for me. In 2010 I joined the Y-Combinator startup <a href='http://en.wikipedia.org/wiki/Cloudkick'>Cloudkick</a>. Later, when Cloudkick was acquired by Rackspace, I relocated to San Francisco to work for Rackspace in their new <a href='http://rackertalent.com/sanfrancisco/'>San Francisco office</a>.</p>

<p>During that time I had a chance to work with some of the best people in the industry, acquired a lot of new knowledge and experienced a lot of things first-hand.</p>

<p>It&#8217;s impossible to list all the things I&#8217;ve learned and experienced, but just to name a few - I&#8217;ve experienced the startup culture, I&#8217;ve experienced the &#8220;Silicon Valley bubble&#8221;, I helped grow our San Francisco office from ~30 to ~80 people, I worked on <a href='http://www.rackspace.com/cloud/monitoring/'>Cloud Monitoring</a> (successor to Cloudkick), I <a href='http://www.rackspace.com/blog/keep-track-of-your-services-and-applications-with-the-new-rackspace-service-registry/'>launched a product</a> and I learned how things work at a relatively large company.</p>
<div class='imginline'><a class='fancybox' href='/images/2013-06-09-time-for-new-challenges/ck_team_2010_1.jpg' title='Cloudkick team in 2010 (missing Russel Haering)'><img class='inline' src='/images/2013-06-09-time-for-new-challenges/ck_team_2010_1_thumb.jpg' /></a><span class='image-caption'>Cloudkick team in 2010
(missing Russel Haering)</span></div>
<p>Besides all of that, I also met a lot of great people and made a lot of great friends with whom I hope to stay in touch for years to come.</p>

<p>All of that helped me to become not just a better engineer but a better person overall.</p>

<p>Now you might ask, how does all this relate to running your own startup?</p>

<p>The answer is that I&#8217;ve always paid attention to startups, long before I joined Cloudkick.</p>

<p>I&#8217;ve been reading articles, books and news about startups for as long as I had internet connection (~12 years).</p>

<p>Because of that I always wanted to do my own startup. I&#8217;ve had a countless number of side projects, websites and ran many different online communities, but nothing on which I would focus full-time I would personally call a &#8220;real startup&#8221;.</p>

<p>At Cloudkick, I experienced first hand what it was like working with a small and tightly connected team, building a product which makes life easier for customers. The experience just made me want to do it even more.</p>

<h3 id='why_my_own_startup'>Why my own startup?</h3>

<p>I personally believe that best way to learn something new and retain the this knowledge is through first-hand experience. This doesn&#8217;t mean you should just recklessly dive into something without any background or theoretical knowledge. Quite the contrary, if a literature is available, I believe that having a solid theoretical understating of a problem is one of the pre-requisites to make &#8220;learn more through experience&#8221; process really effective.</p>

<p>The same thinking applies to starting my own startup. I&#8217;ve already learned a lot and experience some of that at Cloudkick, but I didn&#8217;t join in a really early phase and I wasn&#8217;t one of the founders.</p>

<p>This means I wasn&#8217;t involved as intimately as I would want from the beginning and I missed a lot of things I still want to learn and experience.</p>

<p>I had plenty of opportunities to join an existing early and not so early stage startup, but I believe that starting my own thing and being a founder will allow me to learn more than I otherwise could.</p>
<div class='imginline'><img class='inline' src='/images/2013-06-09-time-for-new-challenges/raxsf.png' /><span class='image-caption'>Rackspace San Francisco logo by Logan
Welliver</span></div>
<h3 id='why_now'>Why now?</h3>

<p>I believe now is the right time for me, because there are multiple things which will probably change over the years and make it harder for me to do a startup.</p>

<p>Most of the reasons listed bellow aren&#8217;t anything special and a lot of people would simple call those things &#8220;life&#8221;.</p>

<ul>
<li>I&#8217;ve made a lot of friends and connections which I can ask for help and advice</li>

<li>I&#8217;m not settled down or too tied to a particular location yet</li>

<li>I don&#8217;t have a family yet</li>

<li>I&#8217;m still relatively young and don&#8217;t have a lot to lose, but I have plenty to gain (learn new things)</li>

<li>I believe I have the right co-founder. We&#8217;ve known each other for a long time, we both share the same core values, but we both have different background and skills and bring different perspective to the table. I think diversity is very important and all of that makes us a great team.</li>

<li>Most of the things I do well now I will still be able to to well couple of years in the future. In fact, I would argue that I will be able to do those things better because running my own startup will allow me to learn plenty of new things, obtain new experience and allow me to look at the problems from a different perspective. I believe that overall those things will also help make me a better person and engineer down the road.</li>
</ul>
<div class='imginline'><img class='inline' src='/images/2013-06-09-time-for-new-challenges/zen_of_python.png' /><span class='image-caption'><a href='http://www.python.org/dev/peps/pep-0020/'>The Zen of Python</a>, emphasising "Now is better than never"</span></div>
<p>I want to add that none of the things listed above are real blockers for running a (successful) startup. Quite the contrary, I know people who fit in few of the &#8220;categories&#8221; described above who are still very successful at running a startup.</p>

<p>The fact is that those people are in a minority and running a startup by itself is already a hard thing. Looking at it from a pure engineering and common sense perspective it makes sense to eliminate other things which could make it even harder and reduce number of people you could unintentionally hurt (there are plenty of stories about damaged or broken relationships).</p>

<h3 id='what_are_the_next_steps'>What are the next steps?</h3>

<p>When I get back to Slovenia I will first focus on building an MVP and getting it out to users as soon as possible. There will obviously also be a lot of other non-product development effort related to starting and growing a startup (legal, incorporating, marketing, &#8230;) but in the end it will all boil down to to be continuous iteration of the <a href='http://lean.st/principles/build-measure-learn'>Build-Measure-Learn</a> process.</p>
<div class='imginline'><img class='inline' src='/images/2013-06-09-time-for-new-challenges/ls_cycle.jpeg' /><span class='image-caption'>Lean Startup Cycle per Lean Startup
Book</span></div>
<p>I will also try to do a better job with my blog. I will try to write more tech related articles and how my startup is evolving and what I have learned during this process.</p>
    <div class="postfooter">
        <div class="posttags">Tags: <a href="/tags/personal.html">personal</a>, <a href="/tags/startups.html">startups</a>, <a href="/tags/silicon%20valley.html">silicon valley</a></div>
        <div class="postdate">&raquo; <a href="/2013/06/09/time-for-new-challenges.html">Jun 09, 2013</a></div>
    </div>
</div>

<div class="post">
    <h2 id='hosting_apt_repository_on_rackspace_cloudfiles'><a href='/2012/07/22/hosting-apt-repository-on-rackspace-cloud-files.html'>Hosting APT repository on Rackspace CloudFiles</a></h2>

<p>In this post I will describe how to host APT repository on <a href='http://www.rackspace.com/cloud/cloud_hosting_products/files/'>Rackspace Cloud Files</a>.</p>

<p>First you need to create a CDN enabled container. You can do this using Libcloud or the new <a href='https://mycloud.rackspace.com'>Rackspace control panel</a>. Depending on how frequently you are going update your APT repository it is also recommended to lower the container TTL from the default value of 3 days to 900 seconds.</p>

<p>After you have created a CDN enabled container you need to install Python script I wrote which allows you to sychronize files from a local directory to a container hosted in one of the Storage providers <a href='http://libcloud.apache.org/supported_providers.html'>supported by Libcloud</a>.</p>
<div class='highlight'><pre><code class='console'><span class='go'>  sudo pip install file-syncer</span>
</code></pre></div>
<p>Next we are going to create a dummy APT repository::</p>
<div class='highlight'><pre><code class='console'><span class='go'>mkdir -p /tmp/apt-test/conf</span>
<span class='go'>cat &gt; /tmp/apt-test/conf/distributions &lt;&lt;DELIM</span>
<span class='go'>codename: precise</span>
<span class='go'>Components: main</span>
<span class='go'>Architectures: i386 amd64</span>
<span class='go'>DELIM</span>
</code></pre></div>
<p>Add a test package using <code>reprepro</code>:</p>
<div class='highlight'><pre><code class='console'><span class='go'>wget http://us.archive.ubuntu.com/ubuntu/ubuntu/ubuntu/pool/main/a/acpi/acpi_0.09-3ubuntu1_amd64.deb</span>
<span class='go'>reprepro -b /tmp/apt-test/ includedeb precise acpi_0.09-3ubuntu1_amd64.deb</span>
</code></pre></div>
<p>And test the script:</p>
<div class='highlight'><pre><code class='console'><span class='go'>file-syncer --log-level=DEBUG --directory=/tmp/apt-test/ --username=your username --key=your api key --container-name=container name</span>
</code></pre></div>
<p>If everything went well, you should see an output similar to this one:</p>
<div class='highlight'><pre><code class='console'><span class='go'>22 Jul 2012 22:36:05 : INFO     : Using provider: CloudFiles (US)</span>
<span class='go'>22 Jul 2012 22:36:07 : DEBUG    : Found 15 local files</span>
<span class='go'>22 Jul 2012 22:36:08 : DEBUG    : Manifest doesn&#39;t exist, assuming that there are no remote files</span>
<span class='go'>22 Jul 2012 22:36:08 : DEBUG    : Found 0 remote files</span>
<span class='go'>22 Jul 2012 22:36:08 : INFO     : To remove: 0, to upload: 15</span>
<span class='go'>22 Jul 2012 22:36:08 : DEBUG    : Uploading object: db/contents.cache.db</span>
<span class='go'>22 Jul 2012 22:36:08 : DEBUG    : Uploading object: dists/precise/main/binary-amd64/Packages</span>
<span class='go'>22 Jul 2012 22:36:08 : DEBUG    : Uploading object: dists/precise/main/binary-i386/Release</span>
<span class='go'>22 Jul 2012 22:36:08 : DEBUG    : Uploading object: dists/precise/main/binary-i386/Packages</span>
<span class='go'>22 Jul 2012 22:36:08 : DEBUG    : Uploading object: db/packages.db</span>
<span class='go'>22 Jul 2012 22:36:08 : DEBUG    : Uploading object: pool/main/a/acpi/acpi_0.09-3ubuntu1_amd64.deb</span>
<span class='go'>22 Jul 2012 22:36:08 : DEBUG    : Uploading object: db/release.caches.db</span>
<span class='go'>22 Jul 2012 22:36:08 : DEBUG    : Uploading object: db/version</span>
<span class='go'>22 Jul 2012 22:36:08 : DEBUG    : Uploading object: conf/distributions</span>
<span class='go'>22 Jul 2012 22:36:08 : DEBUG    : Uploading object: db/references.db</span>
<span class='go'>22 Jul 2012 22:36:09 : DEBUG    : Object uploaded: dists/precise/main/binary-amd64/Packages</span>
<span class='go'>22 Jul 2012 22:36:09 : DEBUG    : Uploading object: dists/precise/main/binary-i386/Packages.gz</span>
<span class='go'>22 Jul 2012 22:36:09 : DEBUG    : Object uploaded: dists/precise/main/binary-i386/Packages</span>
<span class='go'>22 Jul 2012 22:36:09 : DEBUG    : Uploading object: dists/precise/main/binary-amd64/Packages.gz</span>
<span class='go'>22 Jul 2012 22:36:09 : DEBUG    : Object uploaded: db/release.caches.db</span>
<span class='go'>22 Jul 2012 22:36:09 : DEBUG    : Uploading object: db/checksums.db</span>
<span class='go'>22 Jul 2012 22:36:09 : DEBUG    : Object uploaded: dists/precise/main/binary-i386/Release</span>
<span class='go'>22 Jul 2012 22:36:09 : DEBUG    : Uploading object: dists/precise/main/binary-amd64/Release</span>
<span class='go'>22 Jul 2012 22:36:09 : DEBUG    : Object uploaded: conf/distributions</span>
<span class='go'>22 Jul 2012 22:36:09 : DEBUG    : Uploading object: dists/precise/Release</span>
<span class='go'>22 Jul 2012 22:36:09 : DEBUG    : Object uploaded: db/packages.db</span>
<span class='go'>22 Jul 2012 22:36:09 : DEBUG    : Object uploaded: db/contents.cache.db</span>
<span class='go'>22 Jul 2012 22:36:09 : DEBUG    : Object uploaded: db/references.db</span>
<span class='go'>22 Jul 2012 22:36:09 : DEBUG    : Object uploaded: db/version</span>
<span class='go'>22 Jul 2012 22:36:09 : DEBUG    : Object uploaded: pool/main/a/acpi/acpi_0.09-3ubuntu1_amd64.deb</span>
<span class='go'>22 Jul 2012 22:36:10 : DEBUG    : Object uploaded: dists/precise/main/binary-amd64/Packages.gz</span>
<span class='go'>22 Jul 2012 22:36:10 : DEBUG    : Object uploaded: dists/precise/main/binary-i386/Packages.gz</span>
<span class='go'>22 Jul 2012 22:36:10 : DEBUG    : Object uploaded: db/checksums.db</span>
<span class='go'>22 Jul 2012 22:36:10 : DEBUG    : Object uploaded: dists/precise/Release</span>
<span class='go'>22 Jul 2012 22:36:10 : DEBUG    : Object uploaded: dists/precise/main/binary-amd64/Release</span>
<span class='go'>22 Jul 2012 22:36:11 : INFO     : Synchronization complete, took: 4.62 seconds</span>
</code></pre></div>
<p>After the upload has finished, you can test the repository by adding it to your APT sources list:</p>
<div class='highlight'><pre><code class='console'><span class='go'>  echo &quot;deb http://c15173579.r79.cf2.rackcdn.com precise main&quot; | sudo tee -a /etc/apt/sources.list.d/test-api-repo.list</span>
</code></pre></div>
<p>We are also going to disable APT HTTP request pipeling. This step is required, because a nginx proxy running in front of the CDN doesn&#8217;t seem to support HTTP/1.1 pipelining. If you skip this test apt-get update will still work, but it will get stuck on <code>[Waiting for headers]</code> for a longer period of time.</p>
<div class='highlight'><pre><code class='console'><span class='go'>  echo &quot;Acquire::http::Pipeline-Depth &quot;0&quot;;&quot; | sudo tee -a /etc/apt/apt.conf.d/pipeline-workaround.conf</span>
</code></pre></div>
<p>You can test that everything is working by issuing the following command:</p>
<div class='highlight'><pre><code class='console'><span class='go'>  sudo apt-get update ; sudo apt-cache policy acpi</span>
</code></pre></div>
<p>You should get an output similar to this one:</p>
<div class='highlight'><pre><code class='console'><span class='go'>acpi:</span>
<span class='go'>  Installed: (none)</span>
<span class='go'>  Candidate: 1.6-1</span>
<span class='go'>  Version table:</span>
<span class='go'>     1.6-1 0</span>
<span class='go'>        500 http://us.archive.ubuntu.com/ubuntu/ precise/universe amd64 Packages</span>
<span class='go'>     0.09-3ubuntu1 0</span>
<span class='go'>        500 http://c15173579.r79.cf2.rackcdn.com/ precise/main amd64 Packages</span>
</code></pre></div>
<p>That is it. To make sure your container is always up to date, you need synchronize it every time you add a new packages. This can be achieved in multiple ways:</p>

<ul>
<li>adding a script which runs synchronize command after adding a package</li>

<li>adding a cron job which periodically runs the sync command</li>
</ul>
    <div class="postfooter">
        <div class="posttags">Tags: <a href="/tags/open%20source.html">open source</a>, <a href="/tags/programming.html">programming</a>, <a href="/tags/libcloud.html">libcloud</a>, <a href="/tags/apt.html">apt</a></div>
        <div class="postdate">&raquo; <a href="/2012/07/22/hosting-apt-repository-on-rackspace-cloud-files.html">Jul 22, 2012</a></div>
    </div>
</div>


            </div>
        </div>
        <div id="footer">Powered by <a href="https://github.com/mojombo/jekyll" target="_blank" title="Yeah, if you are a Pythonista don't get too excited, it's Ruby">jekyll</a>, design forked from <a href="http://github.com/mrtazz/blog" target="_blank">Daniel Schauenberg</a></div>

        <script src='/assets/global-0c78c0d2cd691c953ac8514ead5a290b.js' type='text/javascript'></script>

        <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-1107810-12']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

    </body>
</html>
